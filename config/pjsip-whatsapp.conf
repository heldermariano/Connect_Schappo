; =============================================================
; PJSIP â€” WhatsApp Voz via 360Dialog Calling API
; Arquivo: /etc/asterisk/pjsip_whatsapp.conf
; Incluir em pjsip.conf: #include pjsip_whatsapp.conf
; =============================================================

; --- Transport TLS na porta 5061 ---
[transport-tls-whatsapp]
type=transport
protocol=tls
bind=0.0.0.0:5061
cert_file=/etc/asterisk/keys/fullchain.pem
priv_key_file=/etc/asterisk/keys/privkey.pem
method=tlsv1_2
allow_reload=yes

; --- Endpoint para o trunk 360Dialog (numero 556133455701) ---
[360dialog-whatsapp]
type=endpoint
context=from-whatsapp
disallow=all
allow=opus
allow=alaw
allow=ulaw
transport=transport-tls-whatsapp
dtmf_mode=rfc4733
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
ice_support=yes
media_encryption=sdes
trust_id_inbound=yes
send_pai=yes
callerid=WhatsApp <556133455701>
aors=360dialog-whatsapp
auth=360dialog-whatsapp-auth
accountcode=whatsapp

[360dialog-whatsapp-auth]
type=auth
auth_type=userpass
username=556133455701
; Senha fornecida pelo 360Dialog ao habilitar Calling
password=SUBSTITUIR_PELA_SENHA_360DIALOG

[360dialog-whatsapp-aor]
type=aor
contact=sip:sbc.360dialog.io:5061;transport=tls
qualify_frequency=30
qualify_timeout=5
max_contacts=1

; --- Identify: reconhecer chamadas vindas do SBC 360Dialog ---
[360dialog-identify]
type=identify
endpoint=360dialog-whatsapp
; IPs do SBC 360Dialog (verificar documentacao atualizada)
match=sbc.360dialog.io
